openssh: fix CVE-2014-2532

Upstream-Status: Backported

Signed-off-by: Priyanka Shobhan <priyanka_shobhan@mentor.com>
diff -Naur openssh-6.5p1-a/session.c openssh-6.5p1/session.c
--- openssh-6.5p1-a/session.c	2014-05-12 11:41:41.014358065 +0530
+++ openssh-6.5p1/session.c	2014-05-12 11:44:58.938354302 +0530
@@ -987,6 +987,11 @@
 		*envp[0] = NULL;
 		*envsizep = 1;
 	}
+	if (strchr(name, '=') != NULL) {
+		error("Invalid environment variable \"%.100s\"", name);
+		return;
+	}
+
 
 	/*
 	 * Find the slot where the value should be stored.  If the variable
@@ -2225,8 +2230,8 @@
 	char *name, *val;
 	u_int name_len, val_len, i;
 
-	name = packet_get_string(&name_len);
-	val = packet_get_string(&val_len);
+	name = packet_get_cstring(&name_len);
+	val = packet_get_cstring(&val_len);
 	packet_check_eom();
 
 	/* Don't set too many environment variables */

