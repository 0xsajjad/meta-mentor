From 4e54e2f4e0bba53d6ddbd440e308bd9e31885905 Mon Sep 17 00:00:00 2001
From: Awais Belal <awais_belal@mentor.com>
Date: Tue, 29 Jan 2019 14:51:22 +0500
Subject: [PATCH 1/3] udev-extraconf/mount.sh: define mount prefix using a
 variable

This allows easy manipulation of the prefix when and where
needed so the hardcoded string could be managed from a single
location.

Signed-off-by: Awais Belal <awais_belal@mentor.com>
---
 mount.sh | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/mount.sh b/mount.sh
index 6b2e5d6..3ee8558 100644
--- a/mount.sh
+++ b/mount.sh
@@ -8,6 +8,7 @@
 MOUNT="/bin/mount"
 PMOUNT="/usr/bin/pmount"
 UMOUNT="/bin/umount"
+MOUNT_PREFIX="/run/media"
 for line in `grep -h -v ^# /etc/udev/mount.blacklist /etc/udev/mount.blacklist.d/*`
 do
 	if [ ` expr match "$DEVNAME" "$line" ` -gt 0 ];
@@ -30,7 +31,7 @@ automount() {
 		name="${LABEL}-${name}"
 	fi
 
-	! test -d "/run/media/$name" && mkdir -p "/run/media/$name"
+	! test -d "$MOUNT_PREFIX/$name" && mkdir -p "$MOUNT_PREFIX/$name"
 	# Silent util-linux's version of mounting auto
 	if [ "x`readlink $MOUNT`" = "x/bin/mount.util-linux" ] ;
 	then
@@ -48,12 +49,12 @@ automount() {
 		;;
 	esac
 
-	if ! $MOUNT -t auto $DEVNAME "/run/media/$name"
+	if ! $MOUNT -t auto $DEVNAME "$MOUNT_PREFIX/$name"
 	then
-		#logger "mount.sh/automount" "$MOUNT -t auto $DEVNAME \"/run/media/$name\" failed!"
-		rm_dir "/run/media/$name"
+		#logger "mount.sh/automount" "$MOUNT -t auto $DEVNAME \"$MOUNT_PREFIX/$name\" failed!"
+		rm_dir "$MOUNT_PREFIX/$name"
 	else
-		logger "mount.sh/automount" "Auto-mount of [/run/media/$name] successful"
+		logger "mount.sh/automount" "Auto-mount of [$MOUNT_PREFIX/$name] successful"
 		touch "/tmp/.automount-$name"
 	fi
 }
@@ -96,5 +97,5 @@ if [ "$ACTION" = "remove" ] || [ "$ACTION" = "change" ] && [ -x "$UMOUNT" ] && [
 	
 	# Remove empty directories from auto-mounter
 	name="`basename "$DEVNAME"`"
-	test -e "/tmp/.automount-$name" && rm_dir "/run/media/$name"
+	test -e "/tmp/.automount-$name" && rm_dir "$MOUNT_PREFIX/$name"
 fi
-- 
2.11.1

