icu: fix CVE-2013-2924

Upstream-Status: Backported

Signed-off-by: Priyanka Shobhan <priyanka_shobhan@mentor.com>

--- source/i18n/csrucode.cpp	2014-05-26 11:44:47.373555779 +0530
+++ source/i18n/csrucode.cpp	2014-05-26 11:50:15.753549537 +0530
@@ -33,9 +33,10 @@
 {
     const uint8_t *input = textIn->fRawInput;
     int32_t confidence = 0;
+    int32_t length = textIn->fRawLength;
 
-    if (input[0] == 0xFE && input[1] == 0xFF) {
-        confidence = 100;
+        if (length >=2 && input[0] == 0xFE && input[1] == 0xFF) {
+	confidence = 100;
     }
 
     // TODO: Do some statastics to check for unsigned UTF-16BE
@@ -57,9 +58,10 @@
 {
     const uint8_t *input = textIn->fRawInput;
     int32_t confidence = 0;
+    int32_t length = textIn->fRawLength;
 
-    if (input[0] == 0xFF && input[1] == 0xFE && (input[2] != 0x00 || input[3] != 0x00)) {
-        confidence = 100;
+       if (length >= 4 && input[0] == 0xFF && input[1] == 0xFE && (input[2] != 0x00 || input[3] != 0x00)) { 
+	confidence = 100;
     }
 
     // TODO: Do some statastics to check for unsigned UTF-16LE
@@ -81,8 +83,8 @@
     bool hasBOM = FALSE;
     int32_t confidence = 0;
 
-    if (getChar(input, 0) == 0x0000FEFFUL) {
-        hasBOM = TRUE;
+       if (limit > 0 && getChar(input, 0) == 0x0000FEFFUL) { 
+	hasBOM = TRUE;
     }
 
     for(int32_t i = 0; i < limit; i += 4) {
